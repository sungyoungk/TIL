# ë”í‹°ì²´í‚¹

### ğŸ’¡ ë”í‹° ì²´í‚¹(Dirty Checking)ì´ë€?
- JPAëŠ” ì—”í‹°í‹° ë§¤ë‹ˆì €ê°€ ì—”í‹°í‹°ë¥¼ ì €ì¥/ì¡°íšŒ/ìˆ˜ì •/ì‚­ì œë¥¼ í•©ë‹ˆë‹¤.
- ê·¸ëŸ°ë° ì—”í‹°í‹° ë§¤ë‹ˆì €ì˜ ë©”ì„œë“œë¥¼ ì°¾ì•„ë³´ë©´, ì €ì¥(persist)/ì¡°íšŒ(find)/ìˆ˜ì •(?)/ì‚­ì œ(delete)ë¡œ ìˆ˜ì •ì— í•´ë‹¹í•˜ëŠ” ë©”ì„œë“œê°€ ì—†ìŠµë‹ˆë‹¤.
- ëŒ€ì‹ ì— ìˆ˜ì •(?)ì— í•´ë‹¹í•˜ëŠ” ë”í‹° ì²´í‚¹(Dirty Checking)ì„ ì§€ì›í•©ë‹ˆë‹¤.
- ë”í‹° ì²´í‚¹ì€ Transaction ì•ˆì—ì„œ ì—”í‹°í‹°ì˜ ë³€ê²½ì´ ì¼ì–´ë‚˜ë©´, ë³€ê²½ ë‚´ìš©ì„ ìë™ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ëŠ” JPA íŠ¹ì§•ì…ë‹ˆë‹¤.
- *ë°ì´í„°ë² ì´ìŠ¤ì— ë³€ê²½ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì‹œì  : 1) Transaction commit ì‹œì  2) EntityManager flush ì‹œì  3) JPQL ì‚¬ìš© ì‹œì 
- ë˜í•œ, ì˜ì†ì„± ì»¨íƒìŠ¤íŠ¸(Persistence Context) ì•ˆì— ìˆëŠ” ì—”í‹°í‹°ë¥¼ ëŒ€ìƒìœ¼ë¡œ ë”í‹° ì²´í‚¹ì´ ì¼ì–´ë‚©ë‹ˆë‹¤.
- ì—¬ê¸°ì„œ Dirtyë€ "ì—”í‹°í‹° ë°ì´í„°ì˜ ë³€ê²½ëœ ë¶€ë¶„"ìœ¼ë¡œ í•´ì„í•˜ì‹œë©´ ë©ë‹ˆë‹¤. ì¦‰, ë³€ê²½ëœ ë¶€ë¶„ì„ ì²´í¬í•´ì„œ DBì— ë°˜ì˜í•œë‹¤ëŠ” ëœ»ìœ¼ë¡œ 

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-10-08 á„‹á…©á„Œá…¥á†« 12 27 53](https://user-images.githubusercontent.com/101084642/194591261-bbe93c02-e46d-453c-b246-2192cc1eb3d1.png)

### ğŸŒŸë”í‹° ì²´í‚¹ì´ ì¼ì–´ë‚˜ëŠ” í™˜ê²½ - ì•„ë˜ ë‘ ê°€ì§€ ì¡°ê±´ì´ ì¶©ì¡±ë˜ì–´ì•¼ í•œë‹¤
- ì˜ì† ìƒíƒœ(Managed) ì•ˆì— ìˆëŠ” ì—”í‹°í‹°ì¸ ê²½ìš°
- Transaction ì•ˆì—ì„œ ì—”í‹°í‹°ë¥¼ ë³€ê²½í•˜ëŠ” ê²½ìš°

#### Transactionì€ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

     - 1ë²ˆ. Service Layerì—ì„œ @Transactionalì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš°
     
     ```java
     
           @Service
      public class ExampleService {
           @Transactional
           public void updateInfo(Long id, String name) {
                User user = userRepository.findById(id);
                user.setName(name);
           }
      }
     ```

     - 2ë²ˆ. EntityTransactionì„ ì´ìš©í•´ì„œ íŠ¸ëœì­ì…˜ì„ ë²”ìœ„ë¥¼ ì§€ì •í•˜ê³  ì‚¬ìš©í•˜ëŠ” ê²½ìš°
     
     ```java
           @Service
      public class ExampleService {
           public void updateInfo(Long id, String name) {
                EntityManager em = entityManagerFactory.createEntityManager();
                EntityTransaction tx = em.getTransaction();
                // 1. íŠ¸ëœì­ì…˜ ì‹œì‘
                tx.begin();
                // 2.User ì—”í‹°í‹°ë¥¼ ì¡°íšŒ & User ìŠ¤ëƒ…ìƒ· ìƒì„±
                User user = em.find(User.class, id);
                // 3.User ì—”í‹°í‹°ì˜ nameì„ ë³€ê²½
                user.setName(name);
                // 4. íŠ¸ëœì­ì…˜
                // 5.User ìŠ¤ëƒ…ìƒ·ê³¼ ìµœì¢… userì˜ ë‚´ìš©ì„ ë¹„êµí•´ì„œ Dirtyë¥¼ Checking í•´ì„œ Update Query ë°œìƒ
                tx.commit();
           }
      }
     
     ```
