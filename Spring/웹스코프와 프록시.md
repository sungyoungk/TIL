# ì›¹ìŠ¤ì½”í”„ì™€ í”„ë¡ì‹œ.md

- request ìŠ¤ì½”í”„ì˜ ìƒì„± ì‹œì ì„ ObjectProvider ë¡œ ì§€ì—°í•˜ì—¬ ì˜ì¡´ì„± ì£¼ì…ì‹œ request ìŠ¤ì½”í”„ ë¹ˆì•  ì˜í•´ ë°œìƒí•˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í–ˆë‹¤
- í”„ë¡ì‹œ ë°©ì‹ìœ¼ë¡œë„ í•´ë‹¹ ë¬¸ì œ í•´ê²°ì´ ê°€ëŠ¥í•˜ë‹¤

<br>

#### âœ… í”„ë¡ì‹œ ì ìš©í•˜ê¸° - `MyLogger`


`í•µì‹¬ì½”ë“œ`   
```java
@Component
@Scope(value = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)
public class MyLogger {//...}

```
- `procyMode = ScopedMode.TARGET_CLASS`
  - ì ìš©ëŒ€ìƒì´ í´ë˜ìŠ¤ì¸ ê²½ìš° TARGET_CLASS ì„ íƒ
  - ì ìš©ëŒ€ìƒì´ ì¸í„°í˜ì´ìŠ¤ì¸ ê²½ìš° INTERFACE ì„ íƒ
- í”„ë¡ì‹œë¥¼ ì ìš©í•˜ë©´ HTTP request ì™€ ìƒê´€ì—†ì´ ê°€ì§œ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë‹¤ë¥¸ ë¹ˆì— ì£¼ì…í•  ìˆ˜ ìˆë‹¤

`ì „ì²´ì½”ë“œ`
```java

@Component
@Scope(value = "request", proxyMode = ScopedProxyMode.TARGET_CLASS)
public class MyLogger {
    private String uuid;
    private String requestURL;

    public void setRequestURL(String requestURL){
        this.requestURL = requestURL;
    }

    public void log(String message) {
        System.out.println(" [ " + uuid + " ] " + " [ " + requestURL + " ] " + message);
    }

    @PostConstruct
    public void init() {
        uuid = UUID.randomUUID().toString();
        System.out.println(" [ " + uuid + " ] request scope bean create: " + this);

    }

    @PreDestroy
    public void close(){
        System.out.println(" [ " + uuid + " ] request scope bean close: " + this);
    }
}

```

<br>

#### âœ… ì»¨íŠ¸ë¡¤ëŸ¬ - ObjectProvider ì œê±°í•˜ê³  ì›ìƒë³µê·€!
```java
@Controller
@RequiredArgsConstructor
public class LogDemoController {
    private final LogDemoService logDemoService;
    private final MyLogger myLogger;
//    private final ObjectProvider<MyLogger> myLoggerProvider;

    @RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
        String requestURL = request.getRequestURL().toString();
//        MyLogger myLogger = myLoggerProvider.getObject();            //Object í”„ë¡œë°”ì´ë”ë¡œ ë§ˆì´ë¡œê±° ê°€ì ¸ì˜´
        myLogger.setRequestURL(requestURL);

        myLogger.log("controller test");
        logDemoService.logic("testID");
        return "OK";

    }
}
```

<br>

#### âœ… ì„œë¹„ìŠ¤ - ObjectProvider ì œê±°í•˜ê³  ì›ìƒë³µê·€!

```java
@Service
@RequiredArgsConstructor
public class LogDemoService {

    private final MyLogger myLogger;
//    private final ObjectProvider<MyLogger> myLoggerProvider;

    public void logic(String id) {
//        MyLogger myLogger = myLoggerProvider.getObject();
        myLogger.log("service id = " + id );
    }
}
```

<br>

### ğŸ“Œ í”„ë¡ì‹œ ì ìš© ê²°ê³¼
- `ObjectProvider` ë¡œ request ìŠ¤ì½”í”„ ë¹ˆ ìƒì„± ì‹œì  ì§€ì—°ì„ í•´ì œí–ˆëŠ”ë°ë„ ì •ìƒì‘ë™ ëœë‹¤

<br>

### ì›¹ìŠ¤ì½”í”„ì™€ í”„ë¡ì‹œ ì‘ë™ ì›ë¦¬

- `LogDemoController` ì»¨íŠ¸ë¡¤ëŸ¬ì˜ logoDemo ë§¤ì„œë“œ ì•ˆì—ì„œ myLogger ì˜ ì°¸ì¡°ê°’ì„ ì¶œë ¥í•´ë³´ë©´...
```java
@RequestMapping("log-demo")
    @ResponseBody
    public String logDemo(HttpServletRequest request) {
        String requestURL = request.getRequestURL().toString();        

        System.out.println("myLogger = " + myLogger.getClass());   // ì°¸ì¡°ê°’ ì¶œë ¥   
        myLogger.setRequestURL(requestURL);

        myLogger.log("controller test");
        logDemoService.logic("testID");
        return "OK";

    }

```

####âœ… ì¶œë ¥ê²°ê³¼
- MyLogger$$EnhancerBySpringCGLIB$$bc74c8e0 : CGLIB ì´ ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘ìœ¼ë¡œ í”„ë¡ì‹œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì£¼ì…í•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŒ
```text
myLogger = class com.hi.core.common.MyLogger$$EnhancerBySpringCGLIB$$bc74c8e0
 [ 4b8c8788-2ff1-4b75-a3a5-0a4f715da81a ] request scope bean create: com.hi.core.common.MyLogger@447a02a0
 [ 4b8c8788-2ff1-4b75-a3a5-0a4f715da81a ]  [ http://localhost:8080/log-demo ] controller test
 [ 4b8c8788-2ff1-4b75-a3a5-0a4f715da81a ]  [ http://localhost:8080/log-demo ] service id = testID
 [ 4b8c8788-2ff1-4b75-a3a5-0a4f715da81a ] request scope bean close: com.hi.core.common.MyLogger@447a02a0
```

<br>

## ğŸ” CGLIB ë¼ì´ë¸ŒëŸ¬ë¦¬
- CGLIBë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë‚´ í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ì„œ ì£¼ì…í•œë‹¤
- @Scope ì˜ **proxyMode = ScopedProxyMode.TARGET_CLASS)** ë¥¼ ì„¤ì •í•˜ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆëŠ” CGLIB
ë¼ëŠ” ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ì„œ, MyLoggerë¥¼ ìƒì†ë°›ì€ ê°€ì§œ í”„ë¡ì‹œ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.
- ë”°ë¼ì„œ, ì˜ì¡´ê´€ê³„ ì£¼ì…ë„ ì´ í”„ë¡ì‹œ ê°ì²´ê°€ ì£¼ì…ëœë‹¤

<br>

<img width="803" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-09-03 á„‹á…©á„’á…® 4 14 40" src="https://user-images.githubusercontent.com/101084642/188260321-99fc90aa-02f1-4bf4-9d6b-cccb00aa3c6c.png">

<br>

### ğŸŒŸ í”„ë¡ì‹œ ê°ì²´ëŠ” ìš”ì²­ì´ ì˜¤ë©´ ë‚´ë¶€ì—ì„œ ì§„ì§œ ë¹ˆì„ ìš”ì²­í•˜ëŠ” `ìœ„ì„ ë¡œì§` ì„ í¬í•¨í•˜ê³  ìˆë‹¤
- í´ë¼ì´ì–¸íŠ¸ê°€ myLogger.logic() ì„ í˜¸ì¶œí•˜ë©´ ì‚¬ì‹¤ì€ í”„ë¡ì‹œ ê°ì²´ì˜ ë§¤ì„œë“œë¥¼ í˜¸ì¶œí•œ ê²ƒì´ë‹¤
- í”„ë¡ì‹œ ê°ì²´ëŠ” request ìŠ¤ì½”í”„ì˜ ì§„ì§œ myLogger.ligic()ì„ í˜¸ì¶œí•œë‹¤
- í”„ë¡ì‹œ ê°ì²´ëŠ” ì›ë³¸ ê°ì²´ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ê²ƒì´ê¸° ë•Œë¬¸ì— í´ë¼ì´ì–¸íŠ¸ ì…ì¥ì—ì„œëŠ” ì›ë³¸ ê°ì²´ì™€ ë™ì¼í•˜ê²Œ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤**(ë‹¤í˜•ì„±)**

<br>

### ğŸ”¥ Summary
- CGLIB ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ìƒì†ë°›ì€ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ì£¼ì…í•œë‹¤
- í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ìš”ì²­ì´ ì˜¤ë©´ ë‚´ë¶€ì—ì„œ ì‹¤ì œ ë¹ˆì„ ìš”ì²­í•˜ëŠ” ìœ„ì„ ë¡œì§ì„ í¬í•¨í•œë‹¤
- í”„ë¡ì‹œê°ì²´ëŠ” ê°€ì§œ ê°ì²´ì´ê¸° ë•Œë¬¸ì— request ìŠ¤ì½”í”„ì™€ ê´€ë ¨ì´ ì—†ìœ¼ë©° ì‹±ê¸€í†¤ì²˜ëŸ¼ ë™ì‘í•œë‹¤. ì¦‰, request ìŠ¤ì½”í”„ ë¹ˆì´ ìƒì„± ë˜ì§€ ì•Šì•„ë„ ì‘ë™ì´ ëœë‹¤. 
- ì´ëŸ¬í•œ í”„ë¡ì‹œ ê°ì²´ë•ì— ë§ˆì¹˜ ì‹±ê¸€í†¤ ë¹ˆì„ ì ìš©í•œ ë“¯ì´ request ìŠ¤ì½”í”„ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤
- ğŸŒŸ **ObjectProvider (DL), í”„ë¡ì‹œ ì„¤ì • ëª¨ë‘ ì§„ì§œ ê°ì±„ ì¡°íšŒë¥¼ í•„ìš”ì‹œì ê¹Œì§€ ì§€ì—°í•œë‹¤ëŠ” ì  ê¼­ ì´í•´í•˜ê¸°**

<br>

###  ğŸ’” ì£¼ì˜
- request ìŠ¤ì½”í”„ì™€ ê°™ì´ ì¼ë°˜ì ì´ì§€ ì•Šì€ ë¹ˆì€ ì‹±ê¸€í†¤ê³¼ ë‹¤ë¥´ê²Œ ë™ì‘í•˜ë¯€ë¡œ(ì‹±ê¸€í†¤ ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ) ìµœì†Œí™”í•´ì•¼ ìœ ì§€ë³´ìˆ˜ì— ìš©ì´í•˜ë‹¤
